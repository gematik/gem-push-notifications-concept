<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.23">
<title>Notification Management</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child{border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active,#footnotes .footnote a:first-of-type:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article">
<div id="header">
<h1>Notification Management <span class="image right"><img src="../images/gematik_logo.png" alt="gematik logo" width="150"></span></h1>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div id="toc" class="toc">
<div id="toctitle" class="title">Inhaltsverzeichnis</div>
<ul class="sectlevel1">
<li><a href="#_konzept">Konzept</a>
<ul class="sectlevel2">
<li><a href="#_architektur">Architektur <span class="image"><img src="https://img.shields.io/badge/Status-Please_Comment-green" alt="Status Please Comment green"></span></a>
<ul class="sectlevel3">
<li><a href="#_fachdienst">Fachdienst <span class="image"><img src="https://img.shields.io/badge/Status-Please_Comment-green" alt="Status Please Comment green"></span></a></li>
<li><a href="#_push_gateway">Push Gateway <span class="image"><img src="https://img.shields.io/badge/Status-Please_Comment-green" alt="Status Please Comment green"></span></a></li>
<li><a href="#_push_provider">Push Provider <span class="image"><img src="https://img.shields.io/badge/Status-Please_Comment-green" alt="Status Please Comment green"></span></a></li>
<li><a href="#_fdv_instanz">FdV Instanz <span class="image"><img src="https://img.shields.io/badge/Status-Please_Comment-green" alt="Status Please Comment green"></span></a></li>
</ul>
</li>
<li><a href="#_authentisierung">Authentisierung <span class="image"><img src="https://img.shields.io/badge/Status-Please_Comment-green" alt="Status Please Comment green"></span></a></li>
<li><a href="#_verschlüsselung_des_benachrichtigungsinhaltes">Verschlüsselung des Benachrichtigungsinhaltes <span class="image"><img src="https://img.shields.io/badge/Status-Please_Comment-green" alt="Status Please Comment green"></span></a>
<ul class="sectlevel3">
<li><a href="#_beispiel_für_einen_austausch_im_oktober_2023">Beispiel für einen Austausch im Oktober 2023: <span class="image"><img src="https://img.shields.io/badge/Status-Please_Comment-green" alt="Status Please Comment green"></span></a></li>
</ul>
</li>
<li><a href="#_registrierung_einer_epa_fdv_instanz">Registrierung einer ePA-FdV-Instanz <span class="image"><img src="https://img.shields.io/badge/Status-Please_Comment-green" alt="Status Please Comment green"></span></a></li>
<li><a href="#_deregistrierung_einer_fdv_instanz">Deregistrierung einer FdV-Instanz <span class="image"><img src="https://img.shields.io/badge/Status-Please_Comment-green" alt="Status Please Comment green"></span></a></li>
<li><a href="#_liste_aktuelle_pushers_enthalten">Liste aktuelle Pushers enthalten <span class="image"><img src="https://img.shields.io/badge/Status-Please_Comment-green" alt="Status Please Comment green"></span></a></li>
<li><a href="#_versenden_von_push_notifications">Versenden von Push-Notifications <span class="image"><img src="https://img.shields.io/badge/Status-Please_Comment-green" alt="Status Please Comment green"></span></a></li>
</ul>
</li>
<li><a href="#_implementierungsdetails">Implementierungsdetails <span class="image"><img src="https://img.shields.io/badge/Status-Work_In_Progress-red" alt="Status Work In Progress red"></span></a>
<ul class="sectlevel2">
<li><a href="#_priorität">Priorität <span class="image"><img src="https://img.shields.io/badge/Status-Work_In_Progress-red" alt="Status Work In Progress red"></span></a>
<ul class="sectlevel3">
<li><a href="#_apple">Apple</a></li>
<li><a href="#_android">Android</a></li>
<li><a href="#_versenden_aus_push_gateway_sicht">Versenden aus Push Gateway Sicht <span class="image"><img src="https://img.shields.io/badge/Status-Work_In_Progress-red" alt="Status Work In Progress red"></span></a></li>
</ul>
</li>
<li><a href="#_themen_für_produktspezifische_implementierungen">Themen für produktspezifische Implementierungen <span class="image"><img src="https://img.shields.io/badge/Status-Please_Comment-green" alt="Status Please Comment green"></span></a></li>
</ul>
</li>
<li><a href="#_beispiele">Beispiele <span class="image"><img src="https://img.shields.io/badge/Status-Work_In_Progress-red" alt="Status Work In Progress red"></span></a>
<ul class="sectlevel2">
<li><a href="#_device_registrierung">Device Registrierung</a></li>
<li><a href="#_event_trigger">Event-Trigger</a></li>
<li><a href="#_push_gateway_2">Push Gateway</a>
<ul class="sectlevel3">
<li><a href="#_in">IN</a></li>
<li><a href="#_out">OUT</a></li>
</ul>
</li>
<li><a href="#_mobile_app">Mobile App</a>
<ul class="sectlevel3">
<li><a href="#_ios_extension">iOS-Extension:</a></li>
<li><a href="#_android_2">Android:</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="https://img.shields.io/badge/Status-Draft-red" alt="Status Draft red"></span>
<span class="image"><img src="https://img.shields.io/badge/Status-In_Review-orange" alt="Status In Review orange"></span>
<span class="image"><img src="https://img.shields.io/badge/Status-Please_Comment-green" alt="Status Please Comment green"></span>
<span class="image"><img src="https://img.shields.io/badge/Status-OK-green" alt="Status OK green"></span></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_konzept">Konzept</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Versicherte können sich über das mobile FdV mittels Push-Notifications über Ereignisse in Fachdiensten (z.B. ePA-Aktensystem, E-Rezept-Fachdienst, Dienste der Kassen) informieren lassen. Der Versicherte kann im FdV aus den möglichen Ereignissen (zum Beispiel in Form von Channels) diejenigen auswählen, für die er benachrichtigt werden möchte. Standardmäßig werden keine Push-Notifications gesendet.</p>
</div>
<div class="sect2">
<h3 id="_architektur">Architektur <span class="image"><img src="https://img.shields.io/badge/Status-Please_Comment-green" alt="Status Please Comment green"></span></h3>
<div class="paragraph">
<p>An der Umsetzung des Notification Managements sind folgende Komponenten und Services beteiligt:</p>
</div>
<div id="push_overview" class="imageblock">
<div class="content">
<img src="../images/diagrams/push_overview.svg" alt="push overview" width="100%">
</div>
<div class="title">Abbildung 1. Systemüberblick</div>
</div>
<div class="paragraph">
<p>Der Zweck dieses Konzepts besteht darin, eine flexible und sichere Push Infrastruktur bereitzustellen, die es ermöglicht, dass verschiedene Fachdienste Push-Notifications an eine mobile Anwendung senden können.
Durch die Implementierung eines zentralen Push Gateways pro Frontend wird eine einheitliche Schnittstelle geschaffen, die als Fassade für die plattformspezifischen APIs von Anbietern wie Google und Apple fungiert. Dies erlaubt es mehreren Backends, gleichzeitig Push-Benachrichtigungen für eine fremde App bereitzustellen, ohne dass jedes Backend individuell mit den plattformspezifischen APIs interagieren muss. Ein wesentlicher Vorteil dieses Ansatzes ist die erhöhte Sicherheit: Die sensiblen Zugangsdaten und Schlüssel, die für die Nutzung der plattformspezifischen Push-APIs erforderlich sind, verbleiben beim Push Gateway und müssen nicht mit den einzelnen Fachdiensten geteilt werden. Dadurch wird das Risiko eines unbefugten Zugriffs auf diese Geheimnisse minimiert und die Integrität der Kommunikation gewährleistet. Als Vorbild dient die Push Implementierung wie sie im Matrix Protokoll beschrieben ist.</p>
</div>
<div id="push_encrypted_channel" class="imageblock">
<div class="content">
<img src="../images/secret_channel.drawio.svg" alt="secret channel.drawio" width="100%">
</div>
<div class="title">Abbildung 2. Veschlüsselter Kanal zwischen Fachdienst und FdV</div>
</div>
<div class="paragraph">
<p>Um zusätzliche Sicherheit zu gewährleisten kann eine Push-Nachricht zwischen dem Fachdienst und dem FdV verschlüsselt werden. Weder Push Gateway noch Push Provider besitzen die Information um eine Entschlüsselung vorzunehmen. Die Entscheidung ob eine Push-Nachricht verschlüsselt werden muss oder unverschlüsselt bleiben kann wird durch die Spezifikation des jeweiligen Fachdienstes vorgenommen. Bisher wird davon ausgegangen, dass eine Verschlüsselung für ePA und E-Rezept notwending sein wird, diese jedoch bei TIM optional ist.</p>
</div>
<div class="sect3">
<h4 id="_fachdienst">Fachdienst <span class="image"><img src="https://img.shields.io/badge/Status-Please_Comment-green" alt="Status Please Comment green"></span></h4>
<div class="paragraph">
<p>Der anwendungsspezifische Fachdienst verwaltet Geräte die sich bei ihm für den Push-Notification empfang registriert haben. Der Fachdienst erstellt Push-Notifications für vom Nutzer abonnierte Ereignisse und übermittelt diese an das zuständige Push Gateway. Er bietet Schnittstellen für die FdVs der Versicherten zur Registrierung und Konfiguration von Pushern an. Ein Pusher bezieht sich auf eine FdV-Instanz und ist eine Konfiguration im Fachdienst, in der die Informationen zur Adressierung der Push-Notifications hinterlegt werden (u.a. das zu nutzende Push Gateway, Schlüssel zur Verschlüsselung von Nachrichteninhalten). Der Versicherte kann für mehrere Endgeräte Pusher im Fachdienst hinterlegen.</p>
</div>
</div>
<div class="sect3">
<h4 id="_push_gateway">Push Gateway <span class="image"><img src="https://img.shields.io/badge/Status-Please_Comment-green" alt="Status Please Comment green"></span></h4>
<div class="paragraph">
<p>Das Push Gateway besitzt einen anwendungsübergreifenden Endpunkt, an den Push-Notifications übermittelt werden. Das Push Gateway leitet die Informationen der Push-Notification an den Push Provider weiter. Es wird vom Hersteller des FdV bereitgestellt, und es kann weitere Endpunkte für Kassendienste geben, die ebenfalls über dieses Push Gateway Notifications versenden.</p>
</div>
</div>
<div class="sect3">
<h4 id="_push_provider">Push Provider <span class="image"><img src="https://img.shields.io/badge/Status-Please_Comment-green" alt="Status Please Comment green"></span></h4>
<div class="paragraph">
<p>Der Push Provider ist ein Service des Herstellers des mobilen Betriebssystems (z.B. Google, Apple). Der Push Provider sendet Notifications an App-Instanzen auf Endgeräten der Nutzer.</p>
</div>
</div>
<div class="sect3">
<h4 id="_fdv_instanz">FdV Instanz <span class="image"><img src="https://img.shields.io/badge/Status-Please_Comment-green" alt="Status Please Comment green"></span></h4>
<div class="paragraph">
<p>Die FdV-Instanz ist ein auf einem mobilen Endgerät installiertes FdV.  Push-Notifications werden für eine FdV-Instanz registriert und an diese gesendet.  Die FdV-Instanz kann mehrere Anwendungen integrieren (ePA, E-Rezept, TI-Messenger, Kassenanwendungen), für die der Versicherte jeweils Push-Notifications auswählen kann.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_authentisierung">Authentisierung <span class="image"><img src="https://img.shields.io/badge/Status-Please_Comment-green" alt="Status Please Comment green"></span></h3>
<div id="push_overview_authentication" class="imageblock">
<div class="content">
<img src="../images/diagrams/push_overview_authentication.svg" alt="push overview authentication" width="100%">
</div>
<div class="title">Abbildung 3. Authentisierung der beteiligten Komponenten</div>
</div>
<div class="paragraph">
<p>Die Verbindungen zwischen Push Gateway und den Fachdiensten sind beidseitig authentisiert und verschlüsselt.
Die anderen sind Fachdienst oder Push-Provider spezifisch.</p>
</div>
</div>
<div class="sect2">
<h3 id="_verschlüsselung_des_benachrichtigungsinhaltes">Verschlüsselung des Benachrichtigungsinhaltes <span class="image"><img src="https://img.shields.io/badge/Status-Please_Comment-green" alt="Status Please Comment green"></span></h3>
<div class="paragraph">
<p>Push-Gateways können verschlüsselten und unverschlüsselte Push-Nachrichten empfangen und weiterleiten. Die Verschlüsselung des Benachrichtigungsinhaltes ist fachdienstspezifisch und wird durch die Spezifikation des Fachdienstes festgelegt.</p>
</div>
<div class="paragraph">
<p>Im Fall von Verschlüsselten Push-Nachrichten wird der Benachrichtigungsinhalt einer jeden Benachrichtigung mittels eines Authenticated-Encryption-Verfahrens verschlüsselt (AES/GCM), sodass der Inhalt der Benachrichtigung nicht von Dritten eingesehen oder verändert werden kann.</p>
</div>
<div class="paragraph">
<p>Wenn sich eine FdV-Instanz beim Fachdienst für Benachrichtigungen registriert, erzeugt die App ein initiales gemeinsames Geheimnis (<code>initial-shared-secret</code> (<code>ISS</code>)) und überträgt dieses kryptographisch gesichert an den Fachdienst. Registriert sich das FdV an verschieden Fachdiensten, so wird für jeden Fachdienst ein eigenes <code>ISS</code> erzeugt.</p>
</div>
<div class="paragraph">
<p>Dieses gemeinsame Geheimnis ist die Grundlage der kryptographischen Sicherung des Benachrichtigungsinhaltes. Die Benachrichtigung wird vom Fachdienst mit verschlüsseltem Benachrichtigungsinhalt über das Push Gateway und den Push Provider an die FdV-Instanz übermittelt.</p>
</div>
<div class="paragraph">
<p>Ganz ähnlich wie bei vielen Messaging-Anwendungen werden die verwendeten Schlüssel für die kryptographische Absicherung der Nachrichten regelmäßig gewechselt auf eine Weise, dass eine Wiederherstellbarkeit von alten Schlüsseln kryptographisch ausgeschlossen ist.</p>
</div>
<div class="paragraph">
<p>Der Fachdienst erhält ein ISS und einen Zeitstempel von dessen Erzeugung von dem FdV bei der Registrierung. Mittels einer "Hashed Message Authentication Code (HMAC)-based key derivation function" (HKDF) [RFC-5869] werden per <code>HKDF(ISS, info="&lt;Jahr&gt;-&lt;Monat&gt;")</code> zwei Werte abgeleitet:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Ein Geheimnis für den Monat und Jahr des Zeitstempels (<code>shared-secret-Jahr-Monat</code>)</p>
</li>
<li>
<p>ein AES/GCM-Schlüssel für den Monat und Jahr des Zeitstempels (<code>AES/GCM-Schlüssel-Jahr-Monat</code>).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Diese beiden Werte werden im Fachdienst sicher gespeichert und das <code>ISS</code> wird im Fachdienst gelöscht.</p>
</div>
<div class="sect3">
<h4 id="_beispiel_für_einen_austausch_im_oktober_2023">Beispiel für einen Austausch im Oktober 2023: <span class="image"><img src="https://img.shields.io/badge/Status-Please_Comment-green" alt="Status Please Comment green"></span></h4>
<div class="paragraph">
<p>Das ISS sei zufällig erzeugt gleich (hexdump) <code>f2ca1bb6c7e907d06dafe4687e579fce76b37e4e93b7605022da52e6ccc26fd2</code>. Dann ergibt <code>HKDF(ISS, info="2023-10", L=64) = (hexdump) 185fed66ea5cabbe00147bbd298b5dab0ed41b57ab254d35897b3a4504306e3b3b4adcd58dea98db8e9cb0f5763fcd04fe932d67926cc04b20ba2a2f304ffff9</code>. Die ersten 32 Byte (256 Bit) sind das <code>shared-secret-2023-10</code> gleich (hexdump) <code>185fed66ea5cabbe00147bbd298b5dab0ed41b57ab254d35897b3a4504306e3b</code> und die letzten 32 Byte sind der <code>AES/GCM-Schlüssel-2023-10</code> ist gleich (hexdump) <code>3b4adcd58dea98db8e9cb0f5763fcd04fe932d67926cc04b20ba2a2f304ffff9</code>.</p>
</div>
<div class="paragraph">
<p>Soll im Oktober 2023 eine Benachrichtigung kryptographisch gesichert werden, um sie an das E-Rezept-FdV zu versenden, dann wird der Schlüssel <code>AES/GCM-Key-2023-10</code> dafür verwendet. Soll im November 2023 eine Benachrichtigung gesichert werden, so muss per <code>HKDF(shared-secret-2023-10, info="2023-11")</code> wieder ein Geheimnis&#8201;&#8212;&#8201;diesmal für November 2023&#8201;&#8212;&#8201;und ein neuer AES/GCM-Schlüssel abgeleitet werden. <code>shared-secret-2023-11 = (hexdump) 0c8662d90b04818afb317406fe7fcfcf8d103cd9bc6ad7847890d28620e85ec3</code>, <code>AES/GCM-Schlüssel-2023-11 = (hexdump) 39aa5dacd538f53f4b956d84c9b8f2e26933274d160b9fd1a263a27681c6331b</code></p>
</div>
<div class="paragraph">
<p>Alle <code>shared-secret-Jahr-Monat</code> und alle AES/GCM-Schlüssel-Jahr-Monat, die älter sind als zwei Monate werden, sowohl im Notification Service als auch im E-Rezept-FdV gelöscht, jedoch niemals das jüngste noch verfügbare (auch wenn es älter als zwei Monate ist).  Der fachliche Hintergrund von "zwei Monaten" ist, dass sichergestellt sein muss, dass falls der E-Rezept-FD die Benachrichtigung Sekunden vor Monatsende erstellt, und diese im E-Rezept-FdV erst nach einigen Sekunden dann im Folgemonat empfangen werden, die Entschlüsselung im E-Rezept-FdV immer noch möglich sein muss.</p>
</div>
<div class="paragraph">
<p>Sollte erst im Januar 2024 die nächste Benachrichtigung gesendet werden, so muss die Ableitung für <code>2023-12</code> erzeugt werden und darauf basierend anschließend die Ableitung für <code>2024-01</code>. Anschließend werden die Ableitungs- und Schlüsseldaten für <code>2023-11</code> gelöscht. Die Schlüsseldaten für <code>2024-01</code> werden für die kryptographische Sicherung verwendet.</p>
</div>
<div class="paragraph">
<p>Somit erreicht man das Ziel, dass bei Kompromittierung eines <code>AES/GCM-Jahr-Monat-Schlüssels</code> nur die Benachrichtigungen der letzten zwei Monate entschlüsselt werden können.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_registrierung_einer_epa_fdv_instanz">Registrierung einer ePA-FdV-Instanz <span class="image"><img src="https://img.shields.io/badge/Status-Please_Comment-green" alt="Status Please Comment green"></span></h3>
<div class="paragraph">
<p>Damit eine FdV-Instanz Push-Notifications empfangen kann, muss diese zunächst beim Push-Provider sowie in den gewünschten Fachdiensten registriert werden.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/diagrams/registration.svg" alt="registration" width="100%">
</div>
<div class="title">Abbildung 4. Registrierung einer FdV-Instanz für Push-Notifications im Fachdienst <span class="image"><img src="https://img.shields.io/badge/Status-Please_Comment-green" alt="Status Please Comment green"></span></div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Die FdV-Instanz registriert sich beim Push Provider und erhält ein pushkey, das die FdV-Instanz eindeutig identifiziert.</p>
</li>
<li>
<p>Die FdV-Instanz erzeugt ein <code>initial_shared_secret</code> und speichert den Zeitpunkt (<code>&lt;Jahr&gt;-&lt;Monat&gt;</code>) zu welchem dieses erzeugt wurde als <code>time_iss_created</code>.</p>
</li>
<li>
<p>Der Nutzer meldet sich beim Fachdienst (z.B. Aktensystem) an und registriert einen Pusher. Teil der Registrierungsdaten sind:</p>
<div class="ulist">
<ul>
<li>
<p>der <code>pushkey</code>,</p>
</li>
<li>
<p>die <code>app_id</code>,</p>
</li>
<li>
<p>die Art des <code>Pushers</code> (<code>kind</code>, hier immer <code>"http"</code>),</p>
</li>
<li>
<p>die Adresse des Push Gateways (<code>data.url</code>)</p>
</li>
<li>
<p>das <code>initial_shared_secret</code></p>
</li>
<li>
<p><code>time_iss_created</code><br>
    <br>
Die genauen Felder und Erklärungen dazu sind in der <a href="../fd_openapi.html#tag/Setup/operation/postPusher">OpenAPI-Spezifikation</a> zu finden. Die <code>app_id</code> und die Adresse des Push Gateways wurden vom Hersteller im FdV hinterlegt.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Die FdV-Instanz und der Fachdienst erzeugen den ersten Schlüssel aus dem <code>initial_shared_secret</code> und dem <code>time_iss_created</code>. Anschließend löschen sie das <code>initial_shared_secret</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Möchte der Versicherte Push Notifications von mehreren Fachdiensten erhalten, wird durch die FdV-Instanz in jedem dieser Fachdienste ein Pusher registriert.</p>
</div>
<div class="listingblock">
<div class="title">Registrierung einer FdV-Instanz für Push-Notifications im Push-Provider</div>
<div class="content">
<pre>      {
        "lang": "en",
        "kind": "http",
        "app_display_name": "Mat Rix",
        "device_display_name": "iPhone 9",
        "app_id": "com.example.app.ios",
        "pushkey": "&lt;APNS/GCM TOKEN&gt;",
        "data": {
          "url": "https://push-gateway.location.here/_matrix/push/v1/notify"
        },
        "append": false
      }</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_deregistrierung_einer_fdv_instanz">Deregistrierung einer FdV-Instanz <span class="image"><img src="https://img.shields.io/badge/Status-Please_Comment-green" alt="Status Please Comment green"></span></h3>
<div class="paragraph">
<p>Der gleiche Endpunkt wird sowohl zur Deregistrierung als auch zur Registrierung bei einer FdV-Instanz verwendet. Bei der Deregistrierung werden nur das <code>pushkey</code>, die <code>app_id</code> und <code>kind</code> (die Art des Pushers benötigt). Die Art des Pushers muss dann null sein, damit der Fachdienst weiß, dass der Pusher gelöscht werden soll.</p>
</div>
</div>
<div class="sect2">
<h3 id="_liste_aktuelle_pushers_enthalten">Liste aktuelle Pushers enthalten <span class="image"><img src="https://img.shields.io/badge/Status-Please_Comment-green" alt="Status Please Comment green"></span></h3>
<div class="paragraph">
<p>Die FdV-Instanz kann eine Liste aller registrierten Pusher des Nutzers durch eine GET Operation auf dem bestimmten Endpunkt des Fachdienstes erhalten. Die Details dazu sind in der <a href="../fd_openapi.html#tag/Setup/operation/getPushers">OpenAPI-Spezifikation</a> beschrieben.</p>
</div>
</div>
<div class="sect2">
<h3 id="_versenden_von_push_notifications">Versenden von Push-Notifications <span class="image"><img src="https://img.shields.io/badge/Status-Please_Comment-green" alt="Status Please Comment green"></span></h3>
<div class="paragraph">
<p>Die folgende Abbildung veranschaulicht den Ablauf, wenn ein Ereignis in einem Fachdienst eintritt, für welches Push-Benachrichtigungen gesendet werden sollen (z.B. wenn ein Nutzer ein neues Dokument in einem Konto des ePA-Aktensystems einstellt):</p>
</div>
<div id="send_push" class="imageblock">
<div class="content">
<img src="../images/diagrams/send_push.svg" alt="send push" width="100%">
</div>
<div class="title">Abbildung 5. Push-Notification-Versand</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Der Fachdienst führt folgende Schritte durch</p>
<div class="olist loweralpha">
<ol class="loweralpha">
<li>
<p>Erzeugen des Nachrichteninhalts für dieses spezifische Ereignis. Die Strukturierung ist fachdienstspezifisch.</p>
</li>
<li>
<p>Erzeugen eines neuen gültigen Schlüssels, wenn kein gültiger vorhanden ist.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Für jeden registrierten Pusher <code>p</code>, der für das Ereignis abonniert ist, wird eine Push-Benachrichtigung <code>Notification_p</code> mit mindestens folgenden Inhalten erzeugt (Die möglichen Felder und deren Beschreibungen sind auf der OpenAPI-Seite zu finden):</p>
<div class="olist loweralpha">
<ol class="loweralpha">
<li>
<p><code>ciphertext</code> = Nachrichteninhalt aus 1a, <code>Base64(IV || Chiffrat || Authentication Tag)</code>  verschlüsselt mit dem aktuell gültigen Schlüssel.</p>
</li>
<li>
<p><code>time_message_encrypted</code> = Zeitpunkt der Verschlüsselung des Nachrichteinhaltes.</p>
</li>
<li>
<p><code>devices</code> = (mindestens: app_id, push_token)</p>
</li>
</ol>
</div>
</li>
<li>
<p>Für jeden Pusher p wird die Push-Benachrichtigung <code>Notification_p</code> an das Push Gateways des Pushers <code>p</code> übermittelt.</p>
</li>
<li>
<p>Das Push Gateway übermittelt die Push-Benachrichtigung <code>Notification_p</code> an den Push Provider.</p>
</li>
<li>
<p>Der Push-Provider sendet die Notification an die zur <code>push_token</code> gehörende FdV-Instanz.</p>
</li>
<li>
<p>Die FdV-Instanz entschlüsselt den Nachrichteninhalt mit dem aktuell gültigen Schlüssel (erzeugt ihn, wenn er nicht schon vorhanden ist) und zeigt dem Nutzer den Nachrichteninhalt entsprechend an.</p>
</li>
<li>
<p>Bei Bedarf kann sich der Nutzer in der FdV-Instanz anmelden, um sich beispielsweise ein eingestelltes Dokument anzusehen.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementierungsdetails">Implementierungsdetails <span class="image"><img src="https://img.shields.io/badge/Status-Work_In_Progress-red" alt="Status Work In Progress red"></span></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_priorität">Priorität <span class="image"><img src="https://img.shields.io/badge/Status-Work_In_Progress-red" alt="Status Work In Progress red"></span></h3>
<div class="sect3">
<h4 id="_apple">Apple</h4>
<div class="paragraph">
<p>prio != high ? 5 : 10</p>
</div>
</div>
<div class="sect3">
<h4 id="_android">Android</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "message":{
    "token":"PUSH_KEY",
    "android": {
      "priority": "HIGH",
    }
    "data":{
      "ciphertext": "ENCRYPTED_DATA_HERE",
      "time_message_encrypted": notification.time_message_encrypted
    }
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_versenden_aus_push_gateway_sicht">Versenden aus Push Gateway Sicht <span class="image"><img src="https://img.shields.io/badge/Status-Work_In_Progress-red" alt="Status Work In Progress red"></span></h4>
<div class="sect4">
<h5 id="_apple_2">Apple</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTP-Header</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Wert</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Beschreibung</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>:method</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>POST</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>:path</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/3/device/<strong>&lt;pushkey&gt;</strong></code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">authorization</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><strong>&lt;provider_token&gt;</strong></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required for token-based authentication</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">apns-push-type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>alert</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">apns-id</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">apns-expiration</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">apns-priority</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;prio != high ? 5 : 10&gt;</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">apns-topic</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">apns-collapse-id</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_themen_für_produktspezifische_implementierungen">Themen für produktspezifische Implementierungen <span class="image"><img src="https://img.shields.io/badge/Status-Please_Comment-green" alt="Status Please Comment green"></span></h3>
<div class="paragraph">
<p>Die folgenden Themen sind in diesem Dokument nicht enthalten, da sie zu stark von der produktspezifischen Implementierung abhängen:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Lokalisierung: Die genaue Implementierung der Lokalisierung ist stark abhängig vom Payload und damit vom spezifischen Anwendungsfall.</p>
</li>
<li>
<p>Channels: Die Anforderungen und Implementierung von Channels sind anwendungsspezifisch und können je nach Produkt variieren.</p>
</li>
<li>
<p>Payload: Die genaue Struktur und der Inhalt der Nutzdaten können je  nach Anwendungsfall und Produktfunktionalität unterschiedlich sein. Die Struktur wird im Fachkonzept der jeweiligen Anwendung spezifiziert.</p>
</li>
<li>
<p>Implementierung des Push Gateways: Die technische Umsetzung des Push-Mechanismus kann von der gewählten Infrastruktur und den spezifischen Anforderungen des Push Gateways abhängen. Die Technologie entwickelt sich schnell weiter, was auch die Kommunikation zwischen Push Gateway und Push Providers beeinflusst.</p>
</li>
<li>
<p>Berechtigung: Die Berechtigungen für die verschiedenen Endpunkte sind anwendungsfallspezifisch und können je nach Produkt variieren.<br></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Für Hinweise zur Implementierung dieser Themen verweisen wir auf die produktspezifischen Spezifikationen und Implementierungsleitfäden.</p>
</div>
<div class="paragraph">
<p>Optionale Features können <a href="optional-features.html">hier</a> gefunden werden.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_beispiele">Beispiele <span class="image"><img src="https://img.shields.io/badge/Status-Work_In_Progress-red" alt="Status Work In Progress red"></span></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_device_registrierung">Device Registrierung</h3>
<div class="listingblock">
<div class="title">Variante 1, Platform via <code>app_id</code></div>
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
    "lang": "en",
    "kind": "http",
    "app_display_name": "Mat Rix",
    "device_display_name": "iPhone 9",
    "app_id": "com.example.app.ios",
    "pushkey": "&lt;APNS/GCM TOKEN&gt;",
    "data": {
        "url": "https://push-gateway.location.here/_matrix/push/v1/notify"
    },
    "append": false
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Variante 2, Platform via <code>data</code></div>
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
    "lang": "en",
    "kind": "http",
    "app_display_name": "Mat Rix",
    "device_display_name": "iPhone 9",
    "app_id": "com.example.app",
    "pushkey": "&lt;APNS/GCM TOKEN&gt;",
    "data": {
        "url": "https://push-gateway.location.here/_matrix/push/v1/notify",
        "platform": "ios"
    },
    "append": false
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Variante 3, Platform via <code>url</code></div>
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
    "lang": "en",
    "kind": "http",
    "app_display_name": "Mat Rix",
    "device_display_name": "iPhone 9",
    "app_id": "com.example.app",
    "pushkey": "&lt;APNS/GCM TOKEN&gt;",
    "data": {
        "url": "https://push-gateway.location.here/ios/_matrix/push/v1/notify"
    },
    "append": false
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_event_trigger">Event-Trigger</h3>
<div class="paragraph">
<p>Beispiel für ein Event-Trigger in ePA:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-pseudo" data-lang="pseudo">function trigger001() {
    user = getUser()
    devices = getDevices(user)
    channel = getChannel(trigger001)

    for device in devices {
        if device.channels[channel].isSubscribed {
            notification = createNotification(trigger001, device)
            sendNotification(notification, channel)
        }
    }
}

function createNotification(trigger, device) {
    time_message_encrypted = date.now().yearAndMonth // "2024-11"
    encryptionKey = getEncryptionKey(device, time_message_encrypted)

    payload = {
        event: "trigger001"
    }

    iv = random(32)
    (cipher, authTag) = aesEncrypt(payload)

    ciphertext = Base64(iv + cipher + authTag)

    return {
        time_message_encrypted: time_message_encrypted,
        ciphertext: ciphertext,
        devices: [
            app_id: device.app_id,
            pushkey: device.pushkey,
            pushkey_ts: device.pushkey_ts,
            data: device.data,
            tweaks: {}
        ]
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_push_gateway_2">Push Gateway</h3>
<div class="paragraph">
<p>Endpoint: <a href="http://localhost:8080/push/v1/notify" class="bare">http://localhost:8080/push/v1/notify</a></p>
</div>
<div class="sect3">
<h4 id="_in">IN</h4>
<div class="listingblock">
<div class="title">Push Gateway payload received</div>
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
    "time_message_encrypted": "2024-11",
    "ciphertext": "asdfdfjksfjklsdljkdsf==",
    "prio": "high",
    "counts": {},
    "devices": [
        {
            "app_id": "de.gematikkk.app.ios",
            "pushkey": "abcd-efghi-jklm-nopq",
            "pushkey_ts": 0,
            "data": {
                "format": "string"
            },
            "tweaks": {
            }
        }
    ]
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_out">OUT</h4>
<div class="sect4">
<h5 id="_apns_apple_push_notification_service">APNS (Apple Push Notification Service)</h5>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. HTTP-Header</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTP-Header</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Wert</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Beschreibung</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>:method</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>POST</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>:path</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/3/device/<strong>&lt;pushkey&gt;</strong></code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">authorization</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><strong>&lt;provider_token&gt;</strong></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required for token-based authentication</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">apns-push-type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>alert</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">apns-priority</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;prio != high ? 5 : 10&gt;</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Push Gateway payload send to Push Provider</div>
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">Payload:
{
    "aps": {
        "mutable-content": true
    }
    "ciphertext": notification.ciphertext,
    "time_message_encrypted": notification.time_message_encrypted
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Push Gateway pseudo code</div>
<div class="content">
<pre class="highlight"><code class="language-pseudo" data-lang="pseudo">if notification.counts.badge then
    payload.aps.badge = notification.counts.badge
end if</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_fcm_firebase_cloud_messaging">FCM (Firebase Cloud Messaging)</h5>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. HTTP-Header</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTP-Header</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Wert</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Beschreibung</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>:method</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>POST</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>:Content-Type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>application/json</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the format of the request</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>:access_token_auth</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Confirms token-based authentication (optional, specific to certain systems)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">authorization</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Authorization</code>: <code>Bearer</code> <code><strong>&lt;provider_token&gt;</strong></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required for token-based authentication.</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Push Gateway payload send to Push Provider</div>
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">Payload:
{
  "message":{
    "token":"PUSH_KEY",
    "android": {
      "priority": "HIGH",
    }
    "data":{
      "ciphertext": "ENCRYPTED_DATA_HERE",
      "time_message_encrypted": notification.time_message_encrypted
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_mobile_app">Mobile App</h3>
<div class="sect3">
<h4 id="_ios_extension">iOS-Extension:</h4>
<div class="listingblock">
<div class="title">Swift Pseudo Code</div>
<div class="content">
<pre class="highlight"><code class="language-swift" data-lang="swift">func didReceive(
    _ request: UNNotificationRequest,
    withContentHandler contentHandler: @escaping (UNNotificationContent) -&gt; Void
) {
  // Retrieve the push notification payload
    let payload = request.content.userInfo

    // Decrypt the ciphertext
    let ciphertext = payload["ciphertext"]
    let decryptedData = decrypt(ciphertext)
    let pushData = JSONDecoder().decode(PushData.self, from: decryptedData)

    // Update the notification content
    let content = request.content.mutableCopy() as! UNMutableNotificationContent
    let title = LocalizedString("notification_title_\(pushData.event_id)")
    let body = LocalizedString("notification_body_\(pushData.event_id)", pushData.documentTitle ?? "*****")
    content.title = title
    content.body = body

    // Call the completion handler with the updated notification content
    contentHandler(content)
}

struct PushData: Codable {
    let eventId: String
    let documentTitle: String?
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_android_2">Android:</h4>
<div class="listingblock">
<div class="title">Kotlin Pseudo Code</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">fun onMessageReceived(
    request: RemoteMessage
) {
    // Retrieve the push notification payload
    val payload = request.data

    // Decrypt the ciphertext
    val ciphertext = payload["ciphertext"]
    val plaintext = decrypt(ciphertext)

    // Update the notification content
    val eventId = payload["event_id"]

    val title = resources.getString(resources.getIdentifier("notification_title_$eventId", "string", packageName))
    val body = resources.getString(resources.getIdentifier("notification_body_$eventId", "string", packageName))

    // Display the notification using the processed title and body
    showNotification(title, body)
}

fun showNotification(title: String?, body: String?) {
    val notificationManager = getSystemService(Context.NOTIFICATION_SERVICE) as NotificationManager
    val notificationId = 1

     // Create a notification channel for Android O (API 26) and above
    if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O) {
        val channel = NotificationChannel(
            "default_channel",
            "Default Channel",
            NotificationManager.IMPORTANCE_HIGH
        )
        notificationManager.createNotificationChannel(channel)
    }
    // Build the notification using NotificationCompat for backward compatibility
    val notification = NotificationCompat.Builder(this, "default_channel")
        .setContentTitle(title)
        .setContentText(body)
        .build()
    // Display the notification with a unique notification ID
    notificationManager.notify(notificationId, notification)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Sync: 22.11.2024 14:56</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2025-01-14 09:12:30 +0100
</div>
</div>
</body>
</html>